<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥åº·é‹å‹•æŒ‡å°å£«å‘ã‘ã‚²ãƒ¼ãƒ  - é€±é–“ãƒ—ãƒ­ã‚°ãƒ©ãƒ ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .level-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #f39c12;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .mode-switch {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
        }

        .mode-btn {
            padding: 8px 15px;
            border: 2px solid white;
            background: transparent;
            color: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mode-btn.active {
            background: white;
            color: #2c3e50;
        }

        .game-content {
            display: grid;
            grid-template-columns: 350px 1fr 400px;
            gap: 30px;
            padding: 30px;
        }

        .client-info {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #3498db;
        }

        .client-info h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .client-detail {
            margin: 10px 0;
            padding: 8px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .client-detail:last-child {
            border-bottom: none;
        }

        /* æ—¥æ¬¡ãƒ¢ãƒ¼ãƒ‰ */
        .daily-mode .exercise-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }

        /* é€±æ¬¡ãƒ¢ãƒ¼ãƒ‰ */
        .weekly-mode .weekly-planner {
            display: block;
        }

        .weekly-planner {
            display: none;
        }

        .weekly-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .day-column {
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            min-height: 400px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .day-column.active {
            border-color: #3498db;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
        }

        .day-header {
            background: #3498db;
            color: white;
            padding: 8px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .day-exercises {
            min-height: 300px;
            position: relative;
        }

        .day-exercise-item {
            background: #ecf9f4;
            border: 1px solid #27ae60;
            border-radius: 8px;
            padding: 8px;
            margin-bottom: 8px;
            font-size: 0.8rem;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }

        .day-exercise-item:hover {
            background: #d5eddf;
            transform: translateY(-2px);
        }

        .day-exercise-item .remove-btn {
            position: absolute;
            top: 2px;
            right: 5px;
            color: #e74c3c;
            cursor: pointer;
            font-weight: bold;
        }

        .day-time-total {
            background: #fff;
            border-radius: 6px;
            padding: 8px;
            margin-top: 10px;
            border-left: 3px solid #3498db;
            font-size: 0.85rem;
        }

        .exercise-pool {
            background: #fff;
            border-radius: 12px;
            padding: 15px;
            border: 2px solid #bdc3c7;
        }

        .exercise-pool h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }

        .exercise-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            max-height: 500px;
            overflow-y: auto;
        }

        .exercise-cards::-webkit-scrollbar {
            width: 6px;
        }

        .exercise-cards::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .exercise-cards::-webkit-scrollbar-thumb {
            background: #3498db;
            border-radius: 3px;
        }

        .exercise-card {
            background: white;
            border: 2px solid #bdc3c7;
            border-radius: 10px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            min-height: 120px;
        }

        .exercise-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border-color: #3498db;
        }

        .exercise-card.selected {
            border-color: #27ae60;
            background: #ecf9f4;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(39, 174, 96, 0.2);
        }

        .exercise-name {
            font-size: 0.9rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 4px;
        }

        .exercise-details {
            font-size: 0.8rem;
            color: #e74c3c;
            margin-bottom: 3px;
            font-weight: bold;
        }

        .exercise-type {
            color: #7f8c8d;
            font-size: 0.75rem;
            margin-bottom: 2px;
        }

        .exercise-intensity {
            color: #f39c12;
            font-weight: bold;
            font-size: 0.75rem;
        }

        .results-panel {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #e74c3c;
        }

        .score-display {
            text-align: center;
            margin-bottom: 20px;
        }

        .score-number {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 5px;
            transition: all 0.3s ease;
        }

        .score-excellent { color: #27ae60; }
        .score-good { color: #f39c12; }
        .score-poor { color: #e74c3c; }

        .score-label {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .weekly-summary {
            background: #fff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 3px solid #9b59b6;
        }

        .weekly-summary h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 0.9rem;
        }

        .selected-exercises {
            margin-bottom: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .selected-exercises h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .feedback {
            border-radius: 8px;
            margin-top: 15px;
            padding: 15px;
            animation: slideIn 0.3s ease;
        }

        .feedback.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .feedback.warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .feedback.danger {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .controls {
            display: flex;
            gap: 8px;
            margin-top: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #219a52;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-warning:hover {
            background: #d68910;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #f39c12, #27ae60);
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .achievements {
            margin-top: 15px;
            padding: 10px;
            background: #fff;
            border-radius: 8px;
            border: 1px solid #ecf0f1;
        }

        .achievement {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            margin: 2px;
        }

        .achievement.unlocked {
            background: #27ae60;
            animation: bounceIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        .confetti {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .rest-day {
            background: #ffe4e1 !important;
            border-color: #ffb3ba !important;
        }

        .rest-day .day-header {
            background: #ff6b6b !important;
        }

        @media (max-width: 1200px) {
            .game-content {
                grid-template-columns: 1fr;
            }
            
            .weekly-calendar {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 768px) {
            .weekly-calendar {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .exercise-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="mode-switch">
                <button class="mode-btn active" onclick="switchMode('daily')">ğŸ“… æ—¥æ¬¡</button>
                <button class="mode-btn" onclick="switchMode('weekly')">ğŸ“Š é€±é–“</button>
            </div>
            <div class="level-badge" id="levelBadge">ãƒ¬ãƒ™ãƒ« 1</div>
            <h1>ğŸƒâ€â™‚ï¸ é‹å‹•ãƒ—ãƒ­ã‚°ãƒ©ãƒ ä½œæˆã‚²ãƒ¼ãƒ ï¼ˆé€±é–“ãƒ—ãƒ­ã‚°ãƒ©ãƒ ç‰ˆï¼‰</h1>
            <p>å¥åº·é‹å‹•æŒ‡å°å£«é¤Šæˆè¬›åº§ - é€±é–“ãƒ—ãƒ­ã‚°ãƒ©ãƒ ä½œæˆã§å®Ÿè·µçš„ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</p>
        </div>
        
        <div class="game-content daily-mode" id="gameContent">
            <!-- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæƒ…å ± -->
            <div class="client-info">
                <h3>ğŸ‘¤ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæƒ…å ±</h3>
                <div id="clientDetails">
                    <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                </div>
            </div>

            <!-- é‹å‹•é¸æŠã‚¨ãƒªã‚¢ -->
            <div class="exercise-selection">
                <!-- æ—¥æ¬¡ãƒ¢ãƒ¼ãƒ‰ -->
                <div class="daily-selection">
                    <h3 style="text-align: center; margin-bottom: 20px; color: #2c3e50;">ğŸ¯ é©åˆ‡ãªé‹å‹•ã‚’é¸æŠã—ã¦ãã ã•ã„</h3>
                    <div class="exercise-cards" id="exerciseCards">
                        <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- é€±é–“ãƒ¢ãƒ¼ãƒ‰ -->
                <div class="weekly-planner">
                    <h3 style="text-align: center; margin-bottom: 20px; color: #2c3e50;">ğŸ“… é€±é–“ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ã¦ãã ã•ã„</h3>
                    <div class="weekly-calendar" id="weeklyCalendar">
                        <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                    </div>
                    <div class="exercise-pool">
                        <h4>ğŸƒâ€â™‚ï¸ é‹å‹•ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h4>
                        <div class="exercise-cards" id="exercisePool">
                            <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div class="results-panel">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                
                <div class="score-display">
                    <div class="score-number score-poor" id="scoreDisplay">0</div>
                    <div class="score-label">é©åˆã‚¹ã‚³ã‚¢</div>
                </div>

                <!-- é€±é–“ã‚µãƒãƒªãƒ¼ -->
                <div class="weekly-summary" id="weeklySummary" style="display: none;">
                    <h4>ğŸ“Š é€±é–“ã‚µãƒãƒªãƒ¼</h4>
                    <div class="summary-item">
                        <span>ç·é‹å‹•æ™‚é–“:</span>
                        <span id="totalWeeklyTime">0åˆ†</span>
                    </div>
                    <div class="summary-item">
                        <span>é€±é–“ä¸Šé™:</span>
                        <span id="weeklyTimeLimit">0åˆ†</span>
                    </div>
                    <div class="summary-item">
                        <span>é‹å‹•æ—¥æ•°:</span>
                        <span id="exerciseDays">0æ—¥</span>
                    </div>
                    <div class="summary-item">
                        <span>ä¼‘æ¯æ—¥æ•°:</span>
                        <span id="restDays">7æ—¥</span>
                    </div>
                </div>

                <div class="selected-exercises">
                    <h4 id="exerciseCountHeader">âœ… é¸æŠã—ãŸé‹å‹• (<span id="exerciseCount">0</span>)</h4>
                    <div id="selectedList">
                        <p style="color: #7f8c8d; font-style: italic;">é‹å‹•ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</p>
                    </div>
                </div>

                <div id="feedback" class="feedback" style="display: none;">
                    <!-- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¡¨ç¤º -->
                </div>

                <div class="achievements" id="achievements">
                    <strong>ğŸ† å®Ÿç¸¾:</strong>
                    <div id="achievementList">
                        <!-- å®Ÿç¸¾ãƒãƒƒã‚¸ -->
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" onclick="generateNewClient()">ğŸ”„ æ–°ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</button>
                    <button class="btn btn-success" onclick="evaluateProgram()">ğŸ“Š è©•ä¾¡ã™ã‚‹</button>
                    <button class="btn btn-warning" onclick="clearSelections()">ğŸ—‘ï¸ å…¨ã‚¯ãƒªã‚¢</button>
                    <button class="btn btn-danger" onclick="restartGame()">ğŸ® æœ€åˆã‹ã‚‰</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è©³ç´°ãªé‹å‹•ãƒ‡ãƒ¼ã‚¿
        const exercises = [
            // ã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°ç³»
            {
                id: 1,
                name: "ã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°",
                details: "10-20åˆ†",
                type: "æœ‰é…¸ç´ é‹å‹•",
                intensity: "è»½åº¦ â˜…",
                suitableFor: ["å¥åº·", "è†ç—›", "é«˜è¡€åœ§", "ç³–å°¿ç—…", "é«˜é½¢è€…", "å¿ƒç–¾æ‚£"],
                unsuitable: [],
                points: 15,
                mets: 3,
                duration: 15
            },
            {
                id: 2,
                name: "ã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°",
                details: "30-45åˆ†",
                type: "æœ‰é…¸ç´ é‹å‹•",
                intensity: "ä¸­ç­‰åº¦ â˜…â˜…",
                suitableFor: ["å¥åº·", "è†ç—›", "é«˜è¡€åœ§", "ç³–å°¿ç—…"],
                unsuitable: ["é‡åº¦å¿ƒç–¾æ‚£"],
                points: 25,
                mets: 3,
                duration: 37.5
            },
            {
                id: 3,
                name: "ã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°",
                details: "60åˆ†ä»¥ä¸Š",
                type: "æœ‰é…¸ç´ é‹å‹•",
                intensity: "é«˜å¼·åº¦ â˜…â˜…â˜…",
                suitableFor: ["å¥åº·", "è‹¥å¹´"],
                unsuitable: ["è†ç—›", "é«˜é½¢è€…", "å¿ƒç–¾æ‚£"],
                points: 30,
                mets: 3,
                duration: 60
            },
            {
                id: 4,
                name: "è»½ã„ã‚¸ãƒ§ã‚®ãƒ³ã‚°",
                details: "10-15åˆ†",
                type: "æœ‰é…¸ç´ é‹å‹•",
                intensity: "ä¸­ç­‰åº¦ â˜…â˜…",
                suitableFor: ["å¥åº·", "è‹¥å¹´"],
                unsuitable: ["è†ç—›", "é«˜è¡€åœ§", "é«˜é½¢è€…", "å¿ƒç–¾æ‚£"],
                points: 25,
                mets: 6,
                duration: 12.5
            },
            {
                id: 5,
                name: "ã‚¸ãƒ§ã‚®ãƒ³ã‚°",
                details: "20-30åˆ†",
                type: "æœ‰é…¸ç´ é‹å‹•",
                intensity: "é«˜å¼·åº¦ â˜…â˜…â˜…",
                suitableFor: ["å¥åº·", "è‹¥å¹´"],
                unsuitable: ["è†ç—›", "é«˜è¡€åœ§", "é«˜é½¢è€…", "å¿ƒç–¾æ‚£"],
                points: 35,
                mets: 7,
                duration: 25
            },
            {
                id: 6,
                name: "æ°´ä¸­æ­©è¡Œ",
                details: "20-30åˆ†",
                type: "æœ‰é…¸ç´ é‹å‹•",
                intensity: "è»½åº¦ â˜…",
                suitableFor: ["å¥åº·", "è†ç—›", "é–¢ç¯€ç‚", "é«˜é½¢è€…"],
                unsuitable: [],
                points: 20,
                mets: 4,
                duration: 25
            },
            {
                id: 7,
                name: "æ°´ä¸­æ­©è¡Œ",
                details: "45-60åˆ†",
                type: "æœ‰é…¸ç´ é‹å‹•",
                intensity: "ä¸­ç­‰åº¦ â˜…â˜…",
                suitableFor: ["å¥åº·", "è†ç—›", "é–¢ç¯€ç‚"],
                unsuitable: [],
                points: 30,
                mets: 4,
                duration: 52.5
            },
            {
                id: 8,
                name: "ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ",
                details: "10-20å›",
                type: "ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°",
                intensity: "è»½åº¦ â˜…",
                suitableFor: ["å¥åº·"],
                unsuitable: ["è†ç—›", "è…°ç—›", "é«˜é½¢è€…"],
                points: 15,
                mets: 5,
                duration: 5
            },
            {
                id: 9,
                name: "ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ",
                details: "30-50å›",
                type: "ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°",
                intensity: "ä¸­ç­‰åº¦ â˜…â˜…",
                suitableFor: ["å¥åº·", "è‹¥å¹´"],
                unsuitable: ["è†ç—›", "è…°ç—›", "é«˜é½¢è€…"],
                points: 25,
                mets: 5,
                duration: 8
            },
            {
                id: 10,
                name: "æ¤…å­ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ",
                details: "10-15å›",
                type: "ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°",
                intensity: "è»½åº¦ â˜…",
                suitableFor: ["å¥åº·", "è†ç—›", "é«˜é½¢è€…"],
                unsuitable: [],
                points: 15,
                mets: 3,
                duration: 5
            },
            {
                id: 11,
                name: "æ¤…å­ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ",
                details: "20-30å›",
                type: "ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°",
                intensity: "ä¸­ç­‰åº¦ â˜…â˜…",
                suitableFor: ["å¥åº·", "è†ç—›"],
                unsuitable: [],
                points: 20,
                mets: 3,
                duration: 8
            },
            {
                id: 12,
                name: "è»½ã„ã‚¹ãƒˆãƒ¬ãƒƒãƒ",
                details: "10åˆ†",
                type: "æŸ”è»Ÿæ€§é‹å‹•",
                intensity: "è»½åº¦ â˜…",
                suitableFor: ["å¥åº·", "è†ç—›", "é«˜è¡€åœ§", "ç³–å°¿ç—…", "é«˜é½¢è€…", "å¿ƒç–¾æ‚£"],
                unsuitable: [],
                points: 10,
                mets: 2,
                duration: 10
            },
            {
                id: 13,
                name: "å…¨èº«ã‚¹ãƒˆãƒ¬ãƒƒãƒ",
                details: "20-30åˆ†",
                type: "æŸ”è»Ÿæ€§é‹å‹•",
                intensity: "è»½åº¦ â˜…",
                suitableFor: ["å¥åº·", "è†ç—›", "é«˜è¡€åœ§", "ç³–å°¿ç—…", "é«˜é½¢è€…", "å¿ƒç–¾æ‚£"],
                unsuitable: [],
                points: 20,
                mets: 2,
                duration: 25
            },
            {
                id: 14,
                name: "è»½ã„ç­‹ãƒˆãƒ¬",
                details: "15åˆ†",
                type: "ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°",
                intensity: "è»½åº¦ â˜…",
                suitableFor: ["å¥åº·", "é«˜é½¢è€…"],
                unsuitable: ["æ€¥æ€§ç–¾æ‚£"],
                points: 15,
                mets: 3,
                duration: 15
            },
            {
                id: 15,
                name: "ä¸­ç¨‹åº¦ç­‹ãƒˆãƒ¬",
                details: "30åˆ†",
                type: "ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°",
                intensity: "ä¸­ç­‰åº¦ â˜…â˜…",
                suitableFor: ["å¥åº·", "è‹¥å¹´"],
                unsuitable: ["é«˜é½¢è€…", "æ€¥æ€§ç–¾æ‚£"],
                points: 25,
                mets: 5,
                duration: 30
            },
            {
                id: 16,
                name: "è…•ç«‹ã¦ä¼ã›",
                details: "10-20å›",
                type: "ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°",
                intensity: "ä¸­ç­‰åº¦ â˜…â˜…",
                suitableFor: ["å¥åº·", "è‹¥å¹´"],
                unsuitable: ["è…°ç—›", "é«˜é½¢è€…"],
                points: 20,
                mets: 4,
                duration: 5
            },
            {
                id: 17,
                name: "è†ã¤ãè…•ç«‹ã¦",
                details: "10-15å›",
                type: "ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°",
                intensity: "è»½åº¦ â˜…",
                suitableFor: ["å¥åº·", "é«˜é½¢è€…"],
                unsuitable: ["è…°ç—›"],
                points: 15,
                mets: 3,
                duration: 5
            },
            {
                id: 18,
                name: "è‡ªè»¢è»Š",
                details: "20-30åˆ†",
                type: "æœ‰é…¸ç´ é‹å‹•",
                intensity: "ä¸­ç­‰åº¦ â˜…â˜…",
                suitableFor: ["å¥åº·", "è†ç—›"],
                unsuitable: ["é‡åº¦å¿ƒç–¾æ‚£"],
                points: 25,
                mets: 6,
                duration: 25
            },
            {
                id: 19,
                name: "è‡ªè»¢è»Š",
                details: "45-60åˆ†",
                type: "æœ‰é…¸ç´ é‹å‹•",
                intensity: "é«˜å¼·åº¦ â˜…â˜…â˜…",
                suitableFor: ["å¥åº·", "è‹¥å¹´"],
                unsuitable: ["è†ç—›", "å¿ƒç–¾æ‚£", "é«˜é½¢è€…"],
                points: 35,
                mets: 6,
                duration: 52.5
            },
            {
                id: 20,
                name: "ãƒãƒ©ãƒ³ã‚¹ç·´ç¿’",
                details: "10-15åˆ†",
                type: "ãƒãƒ©ãƒ³ã‚¹é‹å‹•",
                intensity: "è»½åº¦ â˜…",
                suitableFor: ["å¥åº·", "é«˜é½¢è€…", "è†ç—›"],
                unsuitable: [],
                points: 15,
                mets: 2,
                duration: 12.5
            },
            {
                id: 21,
                name: "ä½“å¹¹ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°",
                details: "15åˆ†",
                type: "ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°",
                intensity: "ä¸­ç­‰åº¦ â˜…â˜…",
                suitableFor: ["å¥åº·", "è‹¥å¹´"],
                unsuitable: ["è…°ç—›", "é«˜é½¢è€…"],
                points: 20,
                mets: 4,
                duration: 15
            },
            {
                id: 22,
                name: "éšæ®µæ˜‡é™",
                details: "5-10åˆ†",
                type: "æœ‰é…¸ç´ é‹å‹•",
                intensity: "ä¸­ç­‰åº¦ â˜…â˜…",
                suitableFor: ["å¥åº·"],
                unsuitable: ["è†ç—›", "é«˜é½¢è€…", "å¿ƒç–¾æ‚£"],
                points: 20,
                mets: 8,
                duration: 7.5
            },
            {
                id: 23,
                name: "éšæ®µæ˜‡é™",
                details: "15-20åˆ†",
                type: "æœ‰é…¸ç´ é‹å‹•",
                intensity: "é«˜å¼·åº¦ â˜…â˜…â˜…",
                suitableFor: ["å¥åº·", "è‹¥å¹´"],
                unsuitable: ["è†ç—›", "é«˜é½¢è€…", "å¿ƒç–¾æ‚£", "é«˜è¡€åœ§"],
                points: 30,
                mets: 8,
                duration: 17.5
            },
            {
                id: 24,
                name: "è»½ã„ãƒ€ãƒ³ã‚¹",
                details: "20åˆ†",
                type: "æœ‰é…¸ç´ é‹å‹•",
                intensity: "ä¸­ç­‰åº¦ â˜…â˜…",
                suitableFor: ["å¥åº·"],
                unsuitable: ["è†ç—›", "é«˜é½¢è€…"],
                points: 25,
                mets: 5,
                duration: 20
            }
        ];

        const clientProfiles = [
            {
                name: "ç”°ä¸­ã•ã‚“", age: 65, gender: "ç”·æ€§", 
                goal: "å¥åº·ç¶­æŒ", condition: "è†ç—›", fitness: "ä½", category: "é«˜é½¢è€…",
                notes: "å®šå¹´é€€è·å¾Œã€å¥åº·ã‚’ä¿ã¡ãŸã„",
                dailyTimeLimit: 40, weeklyTimeLimit: 180,
                metsLimit: 15
            },
            {
                name: "ä½è—¤ã•ã‚“", age: 45, gender: "å¥³æ€§", 
                goal: "æ¸›é‡", condition: "å¥åº·", fitness: "ä¸­", category: "è‹¥å¹´",
                notes: "å¿™ã—ã„ä¸­ã§ã‚‚åŠ¹ç‡çš„ã«é‹å‹•ã—ãŸã„",
                dailyTimeLimit: 60, weeklyTimeLimit: 300,
                metsLimit: 23
            },
            {
                name: "å±±ç”°ã•ã‚“", age: 70, gender: "ç”·æ€§", 
                goal: "ç­‹åŠ›å‘ä¸Š", condition: "é«˜è¡€åœ§", fitness: "ä½", category: "é«˜é½¢è€…",
                notes: "è¡€åœ§ç®¡ç†ã‚’ã—ãªãŒã‚‰ç­‹åŠ›ã‚’ã¤ã‘ãŸã„",
                dailyTimeLimit: 30, weeklyTimeLimit: 150,
                metsLimit: 12
            },
            {
                name: "éˆ´æœ¨ã•ã‚“", age: 55, gender: "å¥³æ€§", 
                goal: "ãƒªãƒãƒ“ãƒª", condition: "é–¢ç¯€ç‚", fitness: "ä½", category: "é«˜é½¢è€…",
                notes: "é–¢ç¯€ã«è² æ‹…ã‚’ã‹ã‘ãšã«å‹•ããŸã„",
                dailyTimeLimit: 30, weeklyTimeLimit: 120,
                metsLimit: 10
            },
            {
                name: "é«˜æ©‹ã•ã‚“", age: 38, gender: "ç”·æ€§", 
                goal: "ä½“åŠ›å‘ä¸Š", condition: "å¥åº·", fitness: "ä¸­", category: "è‹¥å¹´",
                notes: "ã‚¹ãƒãƒ¼ãƒ„ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’ä¸Šã’ãŸã„",
                dailyTimeLimit: 90, weeklyTimeLimit: 420,
                metsLimit: 30
            },
            {
                name: "ä¼Šè—¤ã•ã‚“", age: 62, gender: "å¥³æ€§", 
                goal: "å¥åº·ç¶­æŒ", condition: "ç³–å°¿ç—…", fitness: "ä¸­", category: "é«˜é½¢è€…",
                notes: "è¡€ç³–å€¤ç®¡ç†ã®ãŸã‚é‹å‹•ã‚’ç¶šã‘ãŸã„",
                dailyTimeLimit: 45, weeklyTimeLimit: 200,
                metsLimit: 18
            },
            {
                name: "æ¸¡è¾ºã•ã‚“", age: 50, gender: "ç”·æ€§", 
                goal: "æ¸›é‡", condition: "é«˜è¡€åœ§", fitness: "ä½", category: "è‹¥å¹´",
                notes: "ãƒ¡ã‚¿ãƒœæ”¹å–„ã®ãŸã‚é‹å‹•ã‚’å§‹ã‚ãŸã„",
                dailyTimeLimit: 45, weeklyTimeLimit: 240,
                metsLimit: 20
            },
            {
                name: "ä¸­æ‘ã•ã‚“", age: 28, gender: "å¥³æ€§", 
                goal: "ç­‹åŠ›å‘ä¸Š", condition: "å¥åº·", fitness: "é«˜", category: "è‹¥å¹´",
                notes: "ç­‹è‚‰ã‚’ã¤ã‘ã¦ä»£è¬ã‚’ä¸Šã’ãŸã„",
                dailyTimeLimit: 120, weeklyTimeLimit: 480,
                metsLimit: 35
            }
        ];

        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let currentClient = {};
        let selectedExercises = []; // æ—¥æ¬¡ãƒ¢ãƒ¼ãƒ‰ç”¨
        let weeklyProgram = { // é€±é–“ãƒ¢ãƒ¼ãƒ‰ç”¨
            Monday: [], Tuesday: [], Wednesday: [], Thursday: [], 
            Friday: [], Saturday: [], Sunday: []
        };
        let currentScore = 0;
        let totalClients = 0;
        let level = 1;
        let achievements = [];
        let currentMode = 'daily'; // 'daily' or 'weekly'
        let selectedDay = null;

        const dayNames = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
        const dayDisplayNames = ['æœˆæ›œæ—¥', 'ç«æ›œæ—¥', 'æ°´æ›œæ—¥', 'æœ¨æ›œæ—¥', 'é‡‘æ›œæ—¥', 'åœŸæ›œæ—¥', 'æ—¥æ›œæ—¥'];

        // ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
        function switchMode(mode) {
            currentMode = mode;
            const gameContent = document.getElementById('gameContent');
            const modeBtns = document.querySelectorAll('.mode-btn');
            
            modeBtns.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (mode === 'daily') {
                gameContent.className = 'game-content daily-mode';
                selectedExercises = [];
                document.getElementById('weeklySummary').style.display = 'none';
                document.getElementById('exerciseCountHeader').innerHTML = 'âœ… é¸æŠã—ãŸé‹å‹• (<span id="exerciseCount">0</span>)';
            } else {
                gameContent.className = 'game-content weekly-mode';
                clearWeeklyProgram();
                document.getElementById('weeklySummary').style.display = 'block';
                document.getElementById('exerciseCountHeader').innerHTML = 'ğŸ“… é€±é–“ãƒ—ãƒ­ã‚°ãƒ©ãƒ ';
                renderWeeklyCalendar();
                renderExercisePool();
            }
            
            calculateScore();
            updateDisplay();
            renderExerciseCards();
        }

        // ã‚²ãƒ¼ãƒ åˆæœŸåŒ–
        function initGame() {
            generateNewClient();
            renderExerciseCards();
            updateDisplay();
            updateAchievements();
        }

        // æ–°ã—ã„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”Ÿæˆ
        function generateNewClient() {
            currentClient = {...clientProfiles[Math.floor(Math.random() * clientProfiles.length)]};
            selectedExercises = [];
            clearWeeklyProgram();
            currentScore = 0;
            totalClients++;
            
            updateClientDisplay();
            updateDisplay();
            renderExerciseCards();
            if (currentMode === 'weekly') {
                renderWeeklyCalendar();
                renderExercisePool();
            }
            
            document.getElementById('feedback').style.display = 'none';
        }

        // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæƒ…å ±è¡¨ç¤ºæ›´æ–°
        function updateClientDisplay() {
            const details = document.getElementById('clientDetails');
            details.innerHTML = `
                <div class="client-detail"><strong>åå‰:</strong> ${currentClient.name}</div>
                <div class="client-detail"><strong>å¹´é½¢:</strong> ${currentClient.age}æ­³ (${currentClient.gender})</div>
                <div class="client-detail"><strong>ç›®æ¨™:</strong> ${currentClient.goal}</div>
                <div class="client-detail"><strong>å¥åº·çŠ¶æ…‹:</strong> ${currentClient.condition}</div>
                <div class="client-detail"><strong>ä½“åŠ›:</strong> ${currentClient.fitness}ç¨‹åº¦</div>
                <div class="client-detail"><strong>å‚™è€ƒ:</strong> ${currentClient.notes}</div>
                <div class="client-detail" style="color: #e74c3c;"><strong>âš ï¸ é‹å‹•æ™‚é–“ä¸Šé™:</strong> ${currentClient.dailyTimeLimit}åˆ†/æ—¥</div>
                <div class="client-detail" style="color: #e74c3c;"><strong>ğŸ“… é€±é–“ä¸Šé™:</strong> ${currentClient.weeklyTimeLimit}åˆ†/é€±</div>
            `;
        }

        // é€±é–“ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚¯ãƒªã‚¢
        function clearWeeklyProgram() {
            weeklyProgram = {
                Monday: [], Tuesday: [], Wednesday: [], Thursday: [], 
                Friday: [], Saturday: [], Sunday: []
            };
        }

        // é€±é–“ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º
        function renderWeeklyCalendar() {
            const container = document.getElementById('weeklyCalendar');
            container.innerHTML = '';

            dayNames.forEach((day, index) => {
                const dayColumn = document.createElement('div');
                dayColumn.className = 'day-column';
                dayColumn.onclick = () => selectDay(day);
                
                dayColumn.innerHTML = `
                    <div class="day-header">${dayDisplayNames[index]}</div>
                    <div class="day-exercises" id="day-${day}">
                        ${renderDayExercises(day)}
                    </div>
                    <div class="day-time-total">
                        <strong>æ™‚é–“: ${calculateDayTime(day)}åˆ†</strong><br>
                        <small>ä¸Šé™: ${currentClient.dailyTimeLimit}åˆ†</small>
                    </div>
                `;
                
                container.appendChild(dayColumn);
            });
        }

        function selectDay(day) {
            selectedDay = day;
            const dayColumns = document.querySelectorAll('.day-column');
            dayColumns.forEach(col => col.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        function renderDayExercises(day) {
            const exercises = weeklyProgram[day];
            if (exercises.length === 0) {
                return '<p style="color: #7f8c8d; font-style: italic; text-align: center; margin-top: 50px;">é‹å‹•ãªã—<br>ï¼ˆä¼‘æ¯æ—¥ï¼‰</p>';
            }
            
            return exercises.map(exercise => `
                <div class="day-exercise-item" onclick="removeFromDay('${day}', ${exercise.id})">
                    <strong>${exercise.name}</strong><br>
                    <small>${exercise.details} (${exercise.duration}åˆ†)</small>
                    <span class="remove-btn">âœ•</span>
                </div>
            `).join('');
        }

        function calculateDayTime(day) {
            return weeklyProgram[day].reduce((total, exercise) => total + exercise.duration, 0);
        }

        function addToDay(exercise) {
            if (!selectedDay) {
                alert('é‹å‹•ã‚’è¿½åŠ ã™ã‚‹æ›œæ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            const dayTime = calculateDayTime(selectedDay);
            if (dayTime + exercise.duration > currentClient.dailyTimeLimit) {
                alert(`${dayDisplayNames[dayNames.indexOf(selectedDay)]}ã®æ™‚é–“ä¸Šé™ã‚’è¶…éã—ã¾ã™`);
                return;
            }
            
            weeklyProgram[selectedDay].push(exercise);
            renderWeeklyCalendar();
            calculateScore();
            updateDisplay();
        }

        function removeFromDay(day, exerciseId) {
            weeklyProgram[day] = weeklyProgram[day].filter(ex => ex.id !== exerciseId);
            renderWeeklyCalendar();
            calculateScore();
            updateDisplay();
        }

        // é‹å‹•ãƒ—ãƒ¼ãƒ«è¡¨ç¤º
        function renderExercisePool() {
            const container = document.getElementById('exercisePool');
            container.innerHTML = '';

            exercises.forEach(exercise => {
                const card = document.createElement('div');
                card.className = 'exercise-card';
                
                card.innerHTML = `
                    <div class="exercise-name">${exercise.name}</div>
                    <div class="exercise-details">${exercise.details}</div>
                    <div class="exercise-type">${exercise.type}</div>
                    <div class="exercise-intensity">${exercise.intensity}</div>
                `;

                card.onclick = () => addToDay(exercise);
                container.appendChild(card);
            });
        }

        // é‹å‹•ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºï¼ˆæ—¥æ¬¡ãƒ¢ãƒ¼ãƒ‰ï¼‰
        function renderExerciseCards() {
            if (currentMode === 'weekly') return;
            
            const container = document.getElementById('exerciseCards');
            container.innerHTML = '';

            exercises.forEach(exercise => {
                const card = document.createElement('div');
                card.className = 'exercise-card';
                
                const isSelected = selectedExercises.some(ex => ex.id === exercise.id);
                if (isSelected) {
                    card.classList.add('selected');
                }

                card.innerHTML = `
                    <div class="exercise-name">${exercise.name}</div>
                    <div class="exercise-details">${exercise.details}</div>
                    <div class="exercise-type">${exercise.type}</div>
                    <div class="exercise-intensity">${exercise.intensity}</div>
                `;

                card.onclick = () => toggleExercise(exercise);
                container.appendChild(card);
            });
        }

        // é‹å‹•ã®é©åˆæ€§ãƒã‚§ãƒƒã‚¯
        function checkSuitability(exercise, client) {
            for (let condition of exercise.unsuitable) {
                if (client.condition === condition || client.category === condition) {
                    return false;
                }
            }
            
            if (client.fitness === "ä½" && exercise.intensity.includes("â˜…â˜…â˜…")) {
                return false;
            }
            
            return exercise.suitableFor.includes(client.condition) || 
                   exercise.suitableFor.includes(client.category) ||
                   exercise.suitableFor.includes("å¥åº·");
        }

        // é‹å‹•é¸æŠåˆ‡ã‚Šæ›¿ãˆï¼ˆæ—¥æ¬¡ãƒ¢ãƒ¼ãƒ‰ï¼‰
        function toggleExercise(exercise) {
            if (currentMode === 'weekly') return;
            
            const index = selectedExercises.findIndex(ex => ex.id === exercise.id);
            
            if (index > -1) {
                selectedExercises.splice(index, 1);
            } else {
                selectedExercises.push(exercise);
            }
            
            calculateScore();
            updateDisplay();
            renderExerciseCards();
            
            if (index === -1) {
                playSelectEffect();
            }
        }

        // é¸æŠã—ãŸé‹å‹•ã‚’å€‹åˆ¥å‰Šé™¤
        function removeExercise(exerciseId) {
            selectedExercises = selectedExercises.filter(ex => ex.id !== exerciseId);
            calculateScore();
            updateDisplay();
            renderExerciseCards();
        }

        // ã‚¹ã‚³ã‚¢è¨ˆç®—
        function calculateScore() {
            let score = 0;
            let exerciseList = [];
            
            if (currentMode === 'daily') {
                exerciseList = selectedExercises;
            } else {
                // é€±é–“ãƒ¢ãƒ¼ãƒ‰ã§ã¯å…¨ã¦ã®é‹å‹•ã‚’ãƒªã‚¹ãƒˆã«è¿½åŠ 
                exerciseList = Object.values(weeklyProgram).flat();
            }
            
            let suitableCount = 0;
            let typeBalance = [];
            
            exerciseList.forEach(exercise => {
                if (checkSuitability(exercise, currentClient)) {
                    score += exercise.points;
                    suitableCount++;
                    
                    // ç›®æ¨™ãƒœãƒ¼ãƒŠã‚¹
                    if (currentClient.goal === "æ¸›é‡" && exercise.type === "æœ‰é…¸ç´ é‹å‹•") {
                        score += 10;
                    } else if (currentClient.goal === "ç­‹åŠ›å‘ä¸Š" && exercise.type === "ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°") {
                        score += 10;
                    } else if (currentClient.goal === "ãƒªãƒãƒ“ãƒª" && (exercise.type === "æŸ”è»Ÿæ€§é‹å‹•" || exercise.type === "ãƒãƒ©ãƒ³ã‚¹é‹å‹•")) {
                        score += 15;
                    }
                    
                    if (currentClient.category === "é«˜é½¢è€…" && exercise.intensity.includes("â˜…")) {
                        score += 5;
                    }
                    if (currentClient.fitness === "é«˜" && exercise.intensity.includes("â˜…â˜…â˜…")) {
                        score += 5;
                    }
                } else {
                    score -= 20;
                }
                
                if (!typeBalance.includes(exercise.type)) {
                    typeBalance.push(exercise.type);
                }
            });

            // ãƒãƒ©ãƒ³ã‚¹ãƒœãƒ¼ãƒŠã‚¹
            if (typeBalance.length >= 2) {
                score += 15;
            }
            if (typeBalance.length >= 3) {
                score += 15;
            }
            
            // æ™‚é–“åˆ¶é™ãƒã‚§ãƒƒã‚¯
            if (currentMode === 'daily') {
                const totalTime = selectedExercises.reduce((total, ex) => total + ex.duration, 0);
                if (totalTime > currentClient.dailyTimeLimit) {
                    score -= 30;
                } else if (totalTime > currentClient.dailyTimeLimit * 0.8) {
                    score -= 10;
                }
            } else {
                // é€±é–“ãƒ¢ãƒ¼ãƒ‰ç‰¹æœ‰ã®ãƒœãƒ¼ãƒŠã‚¹ãƒ»ãƒšãƒŠãƒ«ãƒ†ã‚£
                const totalWeeklyTime = Object.values(weeklyProgram).flat().reduce((total, ex) => total + ex.duration, 0);
                const exerciseDays = Object.values(weeklyProgram).filter(day => day.length > 0).length;
                const restDays = 7 - exerciseDays;
                
                // é€±é–“æ™‚é–“ä¸Šé™ãƒã‚§ãƒƒã‚¯
                if (totalWeeklyTime > currentClient.weeklyTimeLimit) {
                    score -= 40;
                } else if (totalWeeklyTime > currentClient.weeklyTimeLimit * 0.8) {
                    score -= 15;
                }
                
                // é©åˆ‡ãªä¼‘æ¯æ—¥ãƒœãƒ¼ãƒŠã‚¹
                if (restDays >= 1 && restDays <= 3) {
                    score += 20;
                } else if (restDays === 0) {
                    score -= 25; // ä¼‘æ¯æ—¥ãªã—ãƒšãƒŠãƒ«ãƒ†ã‚£
                } else if (restDays > 4) {
                    score -= 10; // é‹å‹•ä¸è¶³ãƒšãƒŠãƒ«ãƒ†ã‚£
                }
                
                // é€±é–“ç¶™ç¶šæ€§ãƒœãƒ¼ãƒŠã‚¹
                if (exerciseDays >= 3) {
                    score += 15;
                }
                
                // æ—¥åˆ¥æ™‚é–“ä¸Šé™ãƒã‚§ãƒƒã‚¯
                let dailyOverage = 0;
                Object.keys(weeklyProgram).forEach(day => {
                    const dayTime = calculateDayTime(day);
                    if (dayTime > currentClient.dailyTimeLimit) {
                        dailyOverage++;
                    }
                });
                if (dailyOverage > 0) {
                    score -= dailyOverage * 15;
                }
            }

            currentScore = Math.max(0, score);
        }

        // è¡¨ç¤ºæ›´æ–°
        function updateDisplay() {
            // ã‚¹ã‚³ã‚¢è¡¨ç¤º
            const scoreElement = document.getElementById('scoreDisplay');
            scoreElement.textContent = currentScore;
            
            scoreElement.className = 'score-number ';
            if (currentScore >= 80) {
                scoreElement.className += 'score-excellent';
            } else if (currentScore >= 50) {
                scoreElement.className += 'score-good';
            } else {
                scoreElement.className += 'score-poor';
            }

            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = Math.min(currentScore, 100) + '%';

            if (currentMode === 'daily') {
                updateDailyDisplay();
            } else {
                updateWeeklyDisplay();
            }

            // ãƒ¬ãƒ™ãƒ«æ›´æ–°
            level = Math.floor(totalClients / 3) + 1;
            document.getElementById('levelBadge').textContent = `ãƒ¬ãƒ™ãƒ« ${level}`;
        }

        function updateDailyDisplay() {
            const selectedList = document.getElementById('selectedList');
            const exerciseCount = document.getElementById('exerciseCount');
            exerciseCount.textContent = selectedExercises.length;
            
            if (selectedExercises.length === 0) {
                selectedList.innerHTML = '<p style="color: #7f8c8d; font-style: italic;">é‹å‹•ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</p>';
            } else {
                const totalTime = selectedExercises.reduce((total, ex) => total + ex.duration, 0);
                const timeColor = totalTime > currentClient.dailyTimeLimit ? '#e74c3c' : '#27ae60';
                
                let timeDisplay = `<div style="background: #f8f9fa; padding: 8px; margin-bottom: 10px; border-radius: 6px; border-left: 3px solid ${timeColor};">
                                     <strong>â±ï¸ ç·é‹å‹•æ™‚é–“: ${Math.round(totalTime)}åˆ† / ${currentClient.dailyTimeLimit}åˆ†</strong>
                                   </div>`;
                
                selectedList.innerHTML = timeDisplay + selectedExercises.map(exercise => {
                    const suitable = checkSuitability(exercise, currentClient);
                    const bgColor = suitable ? '#ecf9f4' : '#f8d7da';
                    const borderColor = suitable ? '#27ae60' : '#e74c3c';
                    const icon = suitable ? 'âœ“' : 'âš ï¸';
                    
                    return `<div class="selected-exercise" style="background: ${bgColor}; border-left-color: ${borderColor}; padding: 6px 10px; margin: 3px 0; border-radius: 6px; border-left: 3px solid ${borderColor}; position: relative; cursor: pointer; transition: all 0.3s ease; font-size: 0.85rem;" 
                                 onclick="removeExercise(${exercise.id})">
                                ${icon} ${exercise.name} ${exercise.details} (${exercise.duration}åˆ†)
                                <span style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); color: #e74c3c; font-weight: bold; opacity: 0.7;">âœ•</span>
                            </div>`;
                }).join('');
            }
        }

        function updateWeeklyDisplay() {
            const totalWeeklyTime = Object.values(weeklyProgram).flat().reduce((total, ex) => total + ex.duration, 0);
            const exerciseDays = Object.values(weeklyProgram).filter(day => day.length > 0).length;
            const restDays = 7 - exerciseDays;
            
            // é€±é–“ã‚µãƒãƒªãƒ¼æ›´æ–°
            document.getElementById('totalWeeklyTime').textContent = `${totalWeeklyTime}åˆ†`;
            document.getElementById('weeklyTimeLimit').textContent = `${currentClient.weeklyTimeLimit}åˆ†`;
            document.getElementById('exerciseDays').textContent = `${exerciseDays}æ—¥`;
            document.getElementById('restDays').textContent = `${restDays}æ—¥`;
            
            // é¸æŠãƒªã‚¹ãƒˆæ›´æ–°
            const selectedList = document.getElementById('selectedList');
            const allExercises = Object.values(weeklyProgram).flat();
            
            if (allExercises.length === 0) {
                selectedList.innerHTML = '<p style="color: #7f8c8d; font-style: italic;">æ›œæ—¥ã‚’é¸æŠã—ã¦é‹å‹•ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</p>';
            } else {
                const timeColor = totalWeeklyTime > currentClient.weeklyTimeLimit ? '#e74c3c' : '#27ae60';
                
                let programDisplay = `<div style="background: #f8f9fa; padding: 8px; margin-bottom: 10px; border-radius: 6px; border-left: 3px solid ${timeColor};">
                                        <strong>ğŸ“Š é€±é–“åˆè¨ˆ: ${totalWeeklyTime}åˆ† / ${currentClient.weeklyTimeLimit}åˆ†</strong><br>
                                        <small>é‹å‹•æ—¥: ${exerciseDays}æ—¥ | ä¼‘æ¯æ—¥: ${restDays}æ—¥</small>
                                      </div>`;
                
                Object.keys(weeklyProgram).forEach((day, index) => {
                    if (weeklyProgram[day].length > 0) {
                        const dayTime = calculateDayTime(day);
                        const dayColor = dayTime > currentClient.dailyTimeLimit ? '#e74c3c' : '#3498db';
                        
                        programDisplay += `<div style="background: #fff; padding: 8px; margin: 5px 0; border-radius: 6px; border-left: 3px solid ${dayColor};">
                                            <strong>${dayDisplayNames[index]} (${dayTime}åˆ†)</strong><br>
                                            ${weeklyProgram[day].map(ex => `<small>â€¢ ${ex.name} ${ex.details}</small>`).join('<br>')}
                                          </div>`;
                    }
                });
                
                selectedList.innerHTML = programDisplay;
            }
        }

        // å…¨é¸æŠã‚¯ãƒªã‚¢
        function clearSelections() {
            if (currentMode === 'daily') {
                selectedExercises = [];
                renderExerciseCards();
            } else {
                clearWeeklyProgram();
                renderWeeklyCalendar();
            }
            currentScore = 0;
            updateDisplay();
            document.getElementById('feedback').style.display = 'none';
        }

        // ã‚²ãƒ¼ãƒ å†ã‚¹ã‚¿ãƒ¼ãƒˆ
        function restartGame() {
            if (confirm('ã‚²ãƒ¼ãƒ ã‚’æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã—ã¾ã™ã‹ï¼Ÿ')) {
                selectedExercises = [];
                clearWeeklyProgram();
                currentScore = 0;
                totalClients = 0;
                level = 1;
                achievements = [];
                generateNewClient();
                updateAchievements();
            }
        }

        // ãƒ—ãƒ­ã‚°ãƒ©ãƒ è©•ä¾¡
        function evaluateProgram() {
            let feedback = '';
            let feedbackClass = '';
            
            const exerciseList = currentMode === 'daily' ? selectedExercises : Object.values(weeklyProgram).flat();
            
            if (exerciseList.length === 0) {
                feedback = 'âŒ é‹å‹•ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<br>é©åˆ‡ãªé‹å‹•ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚';
                feedbackClass = 'danger';
            } else {
                const suitableCount = exerciseList.filter(ex => checkSuitability(ex, currentClient)).length;
                const unsuitableCount = exerciseList.length - suitableCount;
                const types = [...new Set(exerciseList.map(ex => ex.type))];
                
                if (currentMode === 'daily') {
                    const totalTime = selectedExercises.reduce((total, ex) => total + ex.duration, 0);
                    
                    if (currentScore >= 80) {
                        feedback = `ğŸ‰ ç´ æ™´ã‚‰ã—ã„ï¼å®Œç’§ãªé‹å‹•ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã™ï¼<br>
                                   <strong>ã‚¹ã‚³ã‚¢: ${currentScore}ç‚¹</strong><br>
                                   é©åˆ‡ãªé‹å‹•: ${suitableCount}å€‹ã€ä¸é©åˆ‡: ${unsuitableCount}å€‹<br>
                                   é‹å‹•ç¨®é¡: ${types.length}ç¨®é¡<br>
                                   ç·é‹å‹•æ™‚é–“: ${Math.round(totalTime)}åˆ†ï¼ˆä¸Šé™: ${currentClient.dailyTimeLimit}åˆ†ï¼‰`;
                        feedbackClass = 'success';
                    } else if (currentScore >= 50) {
                        feedback = `ğŸ‘ è‰¯ã„åˆ¤æ–­ã§ã™ï¼æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚<br>
                                   <strong>ã‚¹ã‚³ã‚¢: ${currentScore}ç‚¹</strong><br>
                                   ç·é‹å‹•æ™‚é–“: ${Math.round(totalTime)}åˆ†ï¼ˆä¸Šé™: ${currentClient.dailyTimeLimit}åˆ†ï¼‰`;
                        feedbackClass = 'warning';
                    } else {
                        feedback = `âš ï¸ è¦æ”¹å–„ï¼ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å®‰å…¨ã‚’å†ç¢ºèªã—ã¦ãã ã•ã„ã€‚<br>
                                   <strong>ã‚¹ã‚³ã‚¢: ${currentScore}ç‚¹</strong>`;
                        feedbackClass = 'danger';
                    }
                } else {
                    // é€±é–“ãƒ¢ãƒ¼ãƒ‰è©•ä¾¡
                    const totalWeeklyTime = Object.values(weeklyProgram).flat().reduce((total, ex) => total + ex.duration, 0);
                    const exerciseDays = Object.values(weeklyProgram).filter(day => day.length > 0).length;
                    const restDays = 7 - exerciseDays;
                    
                    if (currentScore >= 80) {
                        feedback = `ğŸ‰ ç´ æ™´ã‚‰ã—ã„ï¼å®Œç’§ãªé€±é–“ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã™ï¼<br>
                                   <strong>ã‚¹ã‚³ã‚¢: ${currentScore}ç‚¹</strong><br>
                                   é©åˆ‡ãªé‹å‹•: ${suitableCount}å€‹ã€ä¸é©åˆ‡: ${unsuitableCount}å€‹<br>
                                   é‹å‹•ç¨®é¡: ${types.length}ç¨®é¡<br>
                                   é€±é–“åˆè¨ˆæ™‚é–“: ${totalWeeklyTime}åˆ†ï¼ˆä¸Šé™: ${currentClient.weeklyTimeLimit}åˆ†ï¼‰<br>
                                   é‹å‹•æ—¥æ•°: ${exerciseDays}æ—¥ã€ä¼‘æ¯æ—¥æ•°: ${restDays}æ—¥<br>
                                   é€±é–“ãƒãƒ©ãƒ³ã‚¹ãŒéå¸¸ã«è‰¯å¥½ã§ã™ï¼`;
                        feedbackClass = 'success';
                        checkAchievements('weeklyPerfect');
                    } else if (currentScore >= 50) {
                        feedback = `ğŸ‘ è‰¯ã„é€±é–“ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã™ï¼æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚<br>
                                   <strong>ã‚¹ã‚³ã‚¢: ${currentScore}ç‚¹</strong><br>
                                   é€±é–“åˆè¨ˆæ™‚é–“: ${totalWeeklyTime}åˆ†ï¼ˆä¸Šé™: ${currentClient.weeklyTimeLimit}åˆ†ï¼‰<br>
                                   é‹å‹•æ—¥æ•°: ${exerciseDays}æ—¥ã€ä¼‘æ¯æ—¥æ•°: ${restDays}æ—¥`;
                        feedbackClass = 'warning';
                    } else {
                        feedback = `âš ï¸ è¦æ”¹å–„ï¼é€±é–“ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’è¦‹ç›´ã—ã¦ãã ã•ã„ã€‚<br>
                                   <strong>ã‚¹ã‚³ã‚¢: ${currentScore}ç‚¹</strong><br>
                                   ${restDays === 0 ? 'âš ï¸ ä¼‘æ¯æ—¥ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚<br>' : ''}
                                   ${totalWeeklyTime > currentClient.weeklyTimeLimit ? 'âš ï¸ é€±é–“æ™‚é–“ä¸Šé™ã‚’è¶…éã—ã¦ã„ã¾ã™ã€‚<br>' : ''}`;
                        feedbackClass = 'danger';
                    }
                }
                
                if (currentScore >= 80) {
                    checkAchievements('perfect');
                    if (currentScore >= 100) showConfetti();
                }
            }

            const feedbackElement = document.getElementById('feedback');
            feedbackElement.innerHTML = feedback;
            feedbackElement.className = `feedback ${feedbackClass}`;
            feedbackElement.style.display = 'block';
            
            checkAchievements('evaluate');
            updateAchievements();
        }

        // å®Ÿç¸¾ãƒã‚§ãƒƒã‚¯
        function checkAchievements(action) {
            if (action === 'perfect' && currentScore >= 80 && !achievements.includes('perfect')) {
                achievements.push('perfect');
            }
            if (action === 'weeklyPerfect' && currentScore >= 80 && currentMode === 'weekly' && !achievements.includes('weeklyMaster')) {
                achievements.push('weeklyMaster');
            }
            if (totalClients >= 5 && !achievements.includes('experienced')) {
                achievements.push('experienced');
            }
            if (action === 'evaluate' && !achievements.includes('evaluator')) {
                achievements.push('evaluator');
            }
            if (currentScore >= 100 && !achievements.includes('master')) {
                achievements.push('master');
            }
            
            // é€±é–“ãƒ¢ãƒ¼ãƒ‰ç‰¹æœ‰ã®å®Ÿç¸¾
            if (currentMode === 'weekly') {
                const exerciseDays = Object.values(weeklyProgram).filter(day => day.length > 0).length;
                const restDays = 7 - exerciseDays;
                
                if (restDays >= 1 && restDays <= 3 && exerciseDays >= 3 && !achievements.includes('balancer')) {
                    achievements.push('balancer');
                }
                
                const types = [...new Set(Object.values(weeklyProgram).flat().map(ex => ex.type))];
                if (types.length >= 4 && !achievements.includes('variety')) {
                    achievements.push('variety');
                }
            }
        }

        // å®Ÿç¸¾è¡¨ç¤ºæ›´æ–°
        function updateAchievements() {
            const achievementList = document.getElementById('achievementList');
            const allAchievements = [
                { id: 'evaluator', name: 'è©•ä¾¡ãƒã‚¹ã‚¿ãƒ¼', desc: 'åˆå›è©•ä¾¡å®Œäº†' },
                { id: 'perfect', name: 'å®Œç’§ä¸»ç¾©è€…', desc: '80ç‚¹ä»¥ä¸Šé”æˆ' },
                { id: 'master', name: 'æŒ‡å°ã®ãƒ—ãƒ­', desc: '100ç‚¹é”æˆ' },
                { id: 'weeklyMaster', name: 'é€±é–“ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼', desc: 'é€±é–“ã§80ç‚¹ä»¥ä¸Š' },
                { id: 'balancer', name: 'ç†æƒ³çš„ãƒãƒ©ãƒ³ã‚¹', desc: 'é©åˆ‡ãªé‹å‹•ãƒ»ä¼‘æ¯æ¯”' },
                { id: 'variety', name: 'å¤šæ§˜æ€§ãƒã‚¹ã‚¿ãƒ¼', desc: '4ç¨®é¡ä»¥ä¸Šã®é‹å‹•' },
                { id: 'experienced', name: 'çµŒé¨“è±Šå¯Œ', desc: '5äººä»¥ä¸ŠæŒ‡å°' }
            ];

            achievementList.innerHTML = allAchievements.map(ach => {
                const unlocked = achievements.includes(ach.id);
                return `<span class="achievement ${unlocked ? 'unlocked' : ''}" title="${ach.desc}">
                          ${unlocked ? 'ğŸ†' : 'ğŸ”’'} ${ach.name}
                        </span>`;
            }).join('');
        }

        // è¦–è¦šåŠ¹æœ
        function playSelectEffect() {
            document.body.style.backgroundColor = '#f8f9fa';
            setTimeout(() => {
                document.body.style.backgroundColor = '';
            }, 100);
        }

        // ç´™å¹é›ªåŠ¹æœ
        function showConfetti() {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.innerHTML = 'ğŸ‰'.repeat(20);
            confetti.style.fontSize = '2rem';
            confetti.style.animation = 'slideIn 2s ease';
            document.body.appendChild(confetti);
            
            setTimeout(() => {
                document.body.removeChild(confetti);
            }, 2000);
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        window.onload = initGame;
    </script>
</body>
</html>